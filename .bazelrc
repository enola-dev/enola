# https://bazel.build/run/bazelrc

# https://github.com/bazelbuild/rules_jvm_external/blob/master/docs/bzlmod.md#installation
common --enable_bzlmod

# Java version must match .devcontainer/devcontainer.json
# https://bazel.build/docs/bazel-and-java#java-versions
common --java_language_version=21
common --tool_java_language_version=21
# https://bazel.build/docs/user-manual#java_runtime_version
common --java_runtime_version=local_jdk_21
common --tool_java_runtime_version=local_jdk_21

# https://github.com/bazelbuild/intellij/issues/1169
common --incompatible_strict_action_env

# https://bazel.build/reference/command-line-reference#flag--test_output
test --test_output=errors

# https://github.com/salesforce/bazel-eclipse/blob/main/docs/common/classpath.md#basics-classpath
# https://bazel.build/reference/command-line-reference#flag--explicit_java_test_deps
# BOTH build and test HAVE to have this - otherwise it's broken due to frequent this:
# "Build option --explicit_java_test_deps has changed, discarding analysis cache."
common --explicit_java_test_deps

# https://github.com/bazelbuild/bazel/issues/4257
# https://bazel.build/docs/user-manual#build-tests-only
test --nobuild_tests_only

# https://github.com/salesforce/bazel-eclipse/blob/main/docs/common/classpath.md#basics-classpath
# For having sources available in the IDE always create source jars, as Bazel doesn't do this by default.
build --output_groups=+_source_jars

# ---

# https://app.buildbuddy.io/invocation/32415476-cb59-443b-a9a9-f7d3124b3362#suggestions

build --remote_cache_compression
build --experimental_remote_cache_compression_threshold=100

# https://bazel.build/reference/command-line-reference#flag--jobs
build --jobs=50

build --noslim_profile
build --experimental_profile_include_target_label
build --experimental_profile_include_primary_output

build --bes_results_url=https://app.buildbuddy.io/invocation/
build --bes_backend=grpcs://remote.buildbuddy.io
build --remote_cache=grpcs://remote.buildbuddy.io
build --remote_timeout=10m

build --remote_executor=grpcs://remote.buildbuddy.io
